"use strict";var materialsController=function(){function e(e){function t(){$("#search").keypress(function(t){13==t.which&&(e.redirect("#/search"),$(".navbar-collapse").collapse("hide"))})}var a=firebase.database().ref();a.on("value",function(n){templates.get("materials").then(function(i){e.$element().html(i(n.val())),a.off("value"),t()})})}function t(e){templates.get("material-add").then(function(t){e.$element().html(t());var a=firebase.database().ref().child("added"),n=firebase.auth().currentUser,i=n.displayName,d=document.getElementById("tb-material-title"),r=document.getElementById("tb-material-text"),l=(document.getElementById("tb-material-link"),document.getElementById("tb-material-des")),o=document.getElementById("btn-add"),c=document.getElementById("alertMsg"),s=document.getElementById("uploader"),u=document.getElementById("fileButton"),m=document.getElementById("fileName"),f=firebase.storage().ref().child("FanfictionImages");u.addEventListener("change",function(e){var t=e.target.files[0],a=firebase.storage().ref("FanfictionImages/"+t.name),n=a.put(t);m.innerHTML=t.name,n.on("state_changed",function(e){var t=e.bytesTransferred/e.totalBytes*100;s.value=t})}),firebase.auth().onAuthStateChanged(function(e){e&&(c.classList.add("hidden"),o.classList.remove("hidden"))}),o.addEventListener("click",function(){var t=d.value,n=r.value,o=l.value,c=m.innerHTML,s=f.child(c),u=(new Date).toString().split(" ").splice(1,3).join(" ");s.getDownloadURL().then(function(d){a.push({title:t,text:n,description:o,imgUrl:d,author:i,date:u}),toastr.success("Added!"),e.redirect("#/fan-fiction")})})})}function a(e){function t(){var a=firebase.database().ref().child("added"),d=a.child(n),r=document.getElementById("tb-comment"),l=document.getElementById("btn-add-comment");firebase.auth().onAuthStateChanged(function(a){a?l.addEventListener("click",function(a){var l=firebase.auth().currentUser,o=l.displayName,c=l.photoURL,s=r.value,u=(new Date).toString().split(" ").splice(1,3).join(" ");d.push({comment:s,photoUrl:c,author:o,date:u}),i.on("value",function(a){var d=a.val().added[n];templates.get("material-details").then(function(a){e.$element().html(a(d)),i.off("value"),t()})}),toastr.success("Your Comment is Added!")}):l.addEventListener("click",function(e){toastr.warning("Register or LogIn to add a comment")})})}function a(){$("#search").keypress(function(t){13==t.which&&e.redirect("#/search")})}var n=e.params.id,i=firebase.database().ref();i.on("value",function(d){var r=d.val().added[n];templates.get("material-details").then(function(n){e.$element().html(n(r)),i.off("value"),t(),a()})})}return{all:e,add:t,one:a}}();